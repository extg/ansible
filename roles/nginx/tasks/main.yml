---

- name: Install nginx
  apt: pkg=nginx state=installed

- name: Copy nginx confing
  template: src={{nginx_conf_template}} dest=/etc/nginx/sites-available/{{inventory_hostname}}.conf
  notify: reload nginx

- name: Enable site
  file: src=/etc/nginx/sites-available/{{inventory_hostname}}.conf path=/etc/nginx/sites-enabled/{{inventory_hostname}}.conf state=link
  notify: reload nginx

- name: Remove default nginx config
  file: path=/etc/nginx/sites-enabled/default state=absent
  notify: reload nginx

#- name: set up a test html page
#  shell: mkdir -p /var/www/{{inventory_hostname}} && echo "Hello Nginx" > /var/www/{{inventory_hostname}}/index.html

#- name: set up a test php page
#  shell: mkdir -p /var/www/{{inventory_hostname}} && echo "<?php phpinfo();" > /var/www/{{inventory_hostname}}/index.php
